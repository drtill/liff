<!DOCTYPE HTML>

<html>
	<head>
		<title>CoinPOS Liff App</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="hello.js"></script>
    <!-- <script src="jquery-3.5.1.min.js"></script> -->
    <script>
      document.write('<link rel="stylesheet" href="css/style.css?cache=' + new Date().getTime() + '">')
  </script>
		<!-- <link rel="stylesheet" type="text/css" href="css/style.css"> -->
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
	</head>
	<body>
		<!-- header -->
		<header id="main-header">
		<div class="container">
			<h1><em>CoinPOS Social</em></h1>
		</div>
		</header>

		<section id="showcase">
		<div class="container">
			<h1><em>E-Commerce Platform</em>
			</h1>
		</div>
		</section>

		<section id ="account"><!-- open account section-->
			<div class="title"><b><em>ร้าน CoinPOS</em></b></div>
			<!---profile (hidden)--->
			<div id="profileInfo" class="hidden">
                <div id="profilePictureDiv">
                </div>
            </div>
            <div id="loginmessage">
                Hello!
                <p id="displayName"><b>displayName:</b> </p>
                .</div>
            <img id="pictureUrl">
            <button>Send an HTTP POST request to a page and get the result back</button>
			<!-- LOGIN LOGOUT BUTTONS -->
            <div class="buttonGroup">
                <button id="liffLoginButton">Log in</button>
                <button id="liffLogoutButton">Log out</button>
            </div>
			<!-- Product #1 -->
			<div class="item">
		</section> <!-- close account section-->

		<div id="cart"><!-- open cart-->
			<div class="title"><b><em>
                <p id="orderNumber"><b>OrderNumber:</b> </p>
            </em></b></div>
			<div class="image1">
				  <!--img src="img/food.jpg" alt="makanan" /-->
				</div>
			<!-- Product #1 -->
			<div class="item">
				<div class="description">
					<span>Paket Bento A</span>
					<span>Nasi, Ebi Furai</span>
					<span>1 Box</span>
				</div>
				<div class="total-price" id="price1">Rp30.000</div>

				<div class="quantity">
					<button class="quant-btn" id="minus-btn1">-</button>
					<input type="text" value="0" id="foodquantity">
					<button class="quant-btn" id="plus-btn1">+</button>
				</div>
			</div>
			<div class="image2">
				  <!--img src="img/food.jpg" alt="makanan" /-->
				</div>
			<!-- Product #2 -->
			<div class="item">
				<div class="description">
					<span>Ocha</span>
					<span>Teh Jepang</span>
					<span>1 Gelas</span>
				</div>
				<div class="total-price" id="price2">Rp10.000</div>

				<div class="quantity">
					<button class="quant-btn" id = "minus-btn2">-</button>
					<input type="text" name="name" value="0" id="drinkquantity">
					<button class="quant-btn" id = "plus-btn2">+</button>

				</div>
				
			</div>

			<div class="order">
				<button class="order-btn" id="order-btn1">Order</button>
			</div>

		</section> <!-- close cart-->
		<!-- </div> -->
		<footer id="main-footer">
			<div class="container"></div>
			<p>Copyright &copy; 2020 Irfan Budi Satria</p>
			</div>
		</footer>

		<!--Konten LIFF v2-->
 
        <div id="liffAppContent">
            <!-- ACTION BUTTONS -->
            <div class="buttonGroup">
                <div class="buttonRow">
                    <button id="openWindowButton" class="smallbtn">Open External Window</button>
                    <button id="closeWindowButton" class="smallbtn">Close LIFF App</button>
                </div>
 
            </div>
 
            <!-- LIFF DATA -->
            <div id="liffData">
                <table>
                    <tr>
                        <th>isInClient : </th>
                        <td id="isInClient" class="textLeft"></td>
                    </tr>
                    <tr>
                        <th>isLoggedIn : </th>
                        <td id="isLoggedIn" class="textLeft"></td>
                    </tr>
                </table>
            </div>
            
            <div id="statusMessage">
                <div id="isInClientMessage"></div>
            </div>
        </div>
        <!-- LIFF ID ERROR -->
        <div id="liffIdErrorMessage" class="hidden">
            <p>You have not assigned any value for LIFF ID.</p>
            <p>If you are running the app using Node.js, please set the LIFF ID as an environment variable in your
                Heroku account follwing the below steps: </p>
            <code id="code-block">
                <ol>
                    <li>Go to `Dashboard` in your Heroku account.</li>
                    <li>Click on the app you just created.</li>
                    <li>Click on `Settings` and toggle `Reveal Config Vars`.</li>
                    <li>Set `MY_LIFF_ID` as the key and the LIFF ID as the value.</li>
                    <li>Your app should be up and running. Enter the URL of your app in a web browser.</li>
                </ol>
            </code>
            <p>If you are using any other platform, please add your LIFF ID in the <code>index.html</code> file.</p>
            <p>For more information about how to add your LIFF ID, see <a
                    href="https://developers.line.biz/en/reference/liff/#initialize-liff-app">Initializing the LIFF
                    app</a>.</p>
        </div>
        <!-- LIFF INIT ERROR -->
        <div id="liffInitErrorMessage" class="hidden">
            <p>Something went wrong with LIFF initialization.</p>
            <p>LIFF initialization can fail if a user clicks "Cancel" on the "Grant permission" screen, or if an error occurs in the process of <code>liff.init()</code>.
        </div>
        <!-- NODE.JS LIFF ID ERROR -->
        <div id="nodeLiffIdErrorMessage" class="hidden">
            <p>Unable to receive the LIFF ID as an environment variable.</p>
        </div>

		<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
		<script src="liff-starter.js"></script>
		<script src="main.js"></script>
        <!-- <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script> -->
  <script>

  // $("button").click(function(){
  //   $.post("demo_test_post.asp",
  //   {
  //     name: "Donald Duck",
  //     city: "Duckburg"
  //   },
  //   function(data, status){
  //     alert("Data: " + data + "\nStatus: " + status);
  //   });
  // });


    function createUniversalLink() {
    }

    async function shareMsg() {
    }

    function logOut() {
    }

    function closed() {
    }

    async function scanCode() {
    }

    function openWindow() {
      liff.openWindow({
        url:"https://line.me",
        external:true
      })
    }

    async function getFriendship() {
      const friend = await liff.getFriendship()

      document.getElementById("friendship").append(friend.friendFlag)
      if(!friend.friendFlag)
      {
        if(confirm("you 're not in bot's friend list. Wanna add friend now?"))
        {
          window.location = "https://line.me/R/ti/p/@1653948984"
        }
      }
    }

    async function sendMsg() {
      alert("Message prepare1")
      try
      {
        if(liff.getContext().type !== "none")
        {
          alert("Message prepare2")
          try
          {
            await liff.sendMessages([
            {
              type:"text",
              text:"Hello, World!"
              //stickerid:1,
              //packageid:1

            }])
            alert("Message sent")
          }
          catch(err)
          {
            alert("Error : " + err.message)
          }
          
        }
        else
        {
          alert("Message no sent")
        }
      }
      catch(err)
      {
        alert("Error2 : " + err.message)
      }
      
    }

    function getContext() {
      document.getElementById("type").append(liff.getContext().type)
      document.getElementById("viewType").append(liff.getContext().viewType)
      document.getElementById("utouId").append(liff.getContext().utouId)
      document.getElementById("roomId").append(liff.getContext().roomId)
      document.getElementById("groupId").append(liff.getContext().groupId)
    }

    async function getUserProfile() {
      const profile = await liff.getProfile()

      document.getElementById("pictureUrl").src = profile.pictureUrl
      //document.getElementById("picUrl").append(profile.pictureUrl)
      //document.getElementById("userId").append(profile.userId)
      //document.getElementById("statusMessage").append(profile.statusMessage)
      document.getElementById("displayName").append(profile.displayName)

      //document.getElementById("decodedIDToken").append(liff.getDecodedIDToken().email)

    }

    function getEnvironment() {
      document.getElementById("os").append(liff.getOS());

      document.getElementById("language").append(liff.getLanguage());

      document.getElementById("version").append(liff.getVersion());

      document.getElementById("accessToken").append(liff.getAccessToken());

      document.getElementById("isInClient").append(liff.isInClient());

      if(liff.isInClient())
      {
        document.getElementById("btnLogOut").style.display = "none"
      }
      else
      {
        document.getElementById("btnMsg").style.display = "none"
        document.getElementById("btnScanCode").style.display = "none"
        document.getElementById("btnClose").style.display = "none"
      }


    }
    function getOrder()
    {
        //alert("Get Order1")
        var itemJson = '{"CompanyId":"2","UserId":"U5bcb2afaf17c20551ab5afdcfec5c1d3"}' 
        try
        {
          //alert("Will Async")
          try
          {

            var data = JSON.stringify({
              'CompanyId': '2',
              'UserId': "U5bcb2afaf17c20551ab5afdcfec5c1d3"
            });

            var xmlhttp = new XMLHttpRequest();
            xmlhttp.withCredentials = true;
                xmlhttp.onreadystatechange = function() 
                {
                    if (this.readyState == 4 && this.status == 200) 
                    {
                        alert("Q = "+this.responseText);
                        
                    }
                    /*else
                    {
                    alert("readyState = "+this.readyState+"<br>");
                    }*/
                };
                xmlhttp.open("POST", "http://coinpos-prod.azurewebsites.net/Services/ServiceContract.svc/JackCloudPOS/Api/GetCountry");
                //xmlhttp.open("POST", "https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder");
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                //xmlhttp.setRequestHeader("x-security-lock', '0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E");
                
                try
                {
                  xmlhttp.send(itemJson);
                }
                catch(err)
                {
                  alert("Error3 : " + err.message)
                }
                






            /*var xhr = new XMLHttpRequest();
            //xhr.withCredentials = true;

            //xhr.addEventListener("readystatechange", function() {
            //  if(this.readyState === 4) {
            //    console.log(this.responseText);
            //  }
            //});
            xhr.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                //document.getElementById("demo").innerHTML = this.responseText;
              }
            };

            xhr.open("POST", "https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder", true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.setRequestHeader("x-security-lock", "0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E");

            xhr.send(data);*/

            /*var Data = {
                    CompanyId:2,UserId:"U5bcb2afaf17c20551ab5afdcfec5c1d3"
                };

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                  if (this.readyState == 4 && this.status == 200) {
                  //document.getElementById("demo").innerHTML = this.responseText;
                  }
                };
                xhttp.open("POST", "https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder");
                
                //xhttp.setRequestHeader("Content-Type", "application/json");
                //xhttp.setRequestHeader("x-security-lock', '0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E");
                xhttp.send('{"CompanyId":2,"UserId":"U5bcb2afaf17c20551ab5afdcfec5c1d3"}');//("fname=Henry&lname=Ford");
                */







                /*var myHeaders = new Headers();
                myHeaders.append("Content-Type", "application/json");
                myHeaders.append("x-security-lock", "0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E");

                var raw = JSON.stringify({
                  "CompanyId": 2,
                  "UserId": "U5bcb2afaf17c20551ab5afdcfec5c1d3"
                });

                var requestOptions = {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'x-security-lock': '0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E'
                  },
                  body: raw,
                  redirect: 'follow'
                };

                fetch("https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder", requestOptions)
                  .then(response => response.text())
                  .then(result => console.log(result))
                  .catch(error => console.log('error', error));*/









            //alert("Will Send")

            
            //xhttp.open("POST", "https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder", true);
            //xhttp.setRequestHeader("Content-type", "application/json");
            //xhttp.send("fname=Henry&lname=Ford");
            $.ajax({
                type: "POST",
                url: "http://coinpos-prod.azurewebsites.net/Services/ServiceContract.svc/JackCloudPOS/Api/GetCountry",
                dataType: "JSON",
                beforeSend: function (xhr) { xhr.setRequestHeader('x-security-lock', '0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E'); },
                //data: JSON.stringify(Data),
                contentType: "application/json;",
                success: function (data) {
                  alert("success")  
                  
                },
                error: function () {
                  alert("Error: ")
                  
                },
                complete: function () {
                  alert("Complete")
                  
                }
            });
            /*const userAction = async () => 
            {
              

              
              const response = await fetch('https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder', 
              {
                      method: 'POST',
                      body: itemJson, // string or object
                      headers: {
                      'Content-Type': 'application/json',
                      'x-security-lock':'0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E'
                      }
              });
                  alert("Send")
                  const myJson = await response.json(); //extract JSON from the http response
                  alert(myJson);
                  
            }*/
            alert("Asynced") 
          }
          catch(err)
          {
            alert("Async Error : " + err.message)
          }
        }
        catch(err)
        {
          alert("Error : " + err.message)
        }
                                                      
    }


    async function getAccessTokenAndChannelID()
    {
      var raw = "";
      var requestOptions = {
        method: 'GET',
        headers: {
          'Authorization': 'Bearer 7NGTM4ddkcS03UcTvH8qVHEFeNGRRLmSgqCTtsCAZ5mxBLLAhcEtU6/Oi6tfwJ21rko08hT7dq+LwMptUzTx/lOFPGCouId1DRO50y8KS6BvaFUBwHYtEV5jpUOdcldEsMvMzHnUIU15nOBKOm10OQdB04t89/1O/w1cDnyilFU=',
          
          },
        redirect: 'follow'
      };
      const fetchPromise = await fetch("https://api.line.me/v2/bot/group/C2930285a261eeeb4b095a3219a32a7b7/member/U5bcb2afaf17c20551ab5afdcfec5c1d3",requestOptions);
      const main = document.getElementById("main");
      fetchPromise.then(response => {
        return response.json();
      }).then(people => {
        main.innerHTML = listOfNames(people);
      });
      function listOfNames(people) {
        const names = people.map(person => `<li>${person.name}</li>`).join("\n");
        return `<ul>${names}</ul>`
      }
      /*const fetchPromise = fetch("https://ghibliapi.herokuapp.com/people");
      const main = document.getElementById("main");
      fetchPromise.then(response => {
        return response.json();
      }).then(people => {
        main.innerHTML = listOfNames(people);
      });
      function listOfNames(people) {
        const names = people.map(person => `<li>${person.name}</li>`).join("\n");
        return `<ul>${names}</ul>`
      }*/
      //const request = require('request-promise')

      /*const json = await request.get({
        url:'https://api.line.me/v2/bot/group/C2930285a261eeeb4b095a3219a32a7b7/member/U5bcb2afaf17c20551ab5afdcfec5c1d3',
        Headers:{'Authorization': 'Bearer 7NGTM4ddkcS03UcTvH8qVHEFeNGRRLmSgqCTtsCAZ5mxBLLAhcEtU6/Oi6tfwJ21rko08hT7dq+LwMptUzTx/lOFPGCouId1DRO50y8KS6BvaFUBwHYtEV5jpUOdcldEsMvMzHnUIU15nOBKOm10OQdB04t89/1O/w1cDnyilFU='},
        json:true
      })
      alert(json.userId)
      alert(json)

      if(json.userId !== '1653948984')
      {
        return 401
      }*/
    }
    function getService()
    {
      var requestOptions = {
        method: 'POST',
        headers: 
        {
          'Content-Type': 'application/json',
          'x-security-lock': '0241CCFF2D40AF7AF8A4FC02272C47A30D15DBDFB36E3266D1296212574F328E'
        },
        redirect: 'follow'
      };

      fetch("https://0c3e-2001-fb1-c5-8ead-f852-9364-92f3-3c98.ap.ngrok.io/Services/ServiceContract.svc/JackCloudPOS/Api/GetLiffOrder", requestOptions)
        .then(response => response.text())
        .then(result => console.log(result))
        .catch(error => console.log('error', error));
    }

    async function main() {
      alert("LINE Developers CoinPOS")
      await liff.init({ liffId: "1656555843-E6WV7arj" })
      //getEnvironment()
      getUserProfile()

      //getAccessTokenAndChannelID()
      getService()
      //getContext()

      //getOrder();
      // getFriendship()
      // createUniversalLink()
    }
    main()
  </script>
	</body>

</html>	